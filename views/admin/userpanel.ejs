<%- include("../includes/navbar") %>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(to right, #ffffff, #f4f4f4);
  }
  .table {
    background-color: white;
    border-radius: 12px;
    overflow: hidden;
  }
  .btn-promote {
    background-color: #00A699;
    color: white;
  }
  .btn-promote:hover {
    background-color: #00897B;
  }
  .btn-delete {
    background-color: #FF5A5F;
    color: white;
  }
  .btn-delete:hover {
    background-color: #e0484c;
  }
  .btn-demote {
    background-color: #FFC107;
    color: white;
  }
  .btn-demote:hover {
    background-color: #e0a800;
  }
</style>

<div class="container py-5">
  <h2 class="text-center mb-4 fw-bold">ðŸ‘¥ User Management Panel</h2>
  <div class="table-responsive">
    <table class="table table-bordered shadow-sm">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% users.forEach((user, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td><%= user.username %></td>
            <td><%= user.email %></td>
            <td>
              <% if (user.role === 'admin') { %>
                <span class="badge bg-success">Admin</span>
              <% } else { %>
                <span class="badge bg-secondary">User</span>
              <% } %>
            </td>
            <td>
              <% if (user._id.toString() !== currUser._id.toString()) { %>
                <% if (user.role === 'admin') { %>
                  <!-- Demote to User -->
                  <form action="/admin/users/<%= user._id %>/demote" method="POST" class="d-inline">
                    <button class="btn btn-sm btn-demote">Demote</button>
                  </form>
                <% } else { %>
                  <!-- Promote to Admin -->
                  <form action="/admin/users/<%= user._id %>/promote" method="POST" class="d-inline">
                    <button class="btn btn-sm btn-promote">Make Admin</button>
                  </form>
                <% } %>
                <!-- Delete User -->
                <form action="/admin/users/<%= user._id %>?_method=DELETE" method="POST" class="d-inline">
                  <button class="btn btn-sm btn-delete">Delete</button>
                </form>
              <% } else { %>
                <span class="text-muted">No actions</span>
              <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>
